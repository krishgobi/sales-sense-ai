{% extends "base.html" %}

{% block title %}Sales Sense AI - Home{% endblock %}

{% block content %}
<<<<<<< HEAD
<!-- Hero Section -->
<div class="text-center mb-4">
    <h1 style="font-size: 2.5rem; font-weight: 700; color: var(--gray-900); margin-bottom: 0.5rem;">
        Welcome to Sales Sense AI
    </h1>
    <p style="font-size: 1.125rem; color: var(--gray-600);">
        Smart Business Intelligence & Analytics Platform
    </p>
</div>

<!-- Quick Stats -->
<div class="grid grid-3 mb-4">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="stat-value" id="totalRevenue">$0</div>
        <div class="stat-label">Total Revenue</div>
        <small id="totalOrders" style="opacity: 0.8;">0 orders</small>
    </div>
    
    <div class="stat-card success">
        <div class="stat-icon">
            <i class="fas fa-box"></i>
=======
<div class="home-container">
    <!-- Hero Section -->
    <div class="hero-section">
        <h1 style="color: #fbbf24; font-weight: 700;">üìä Sales Sense AI</h1>
        <p class="lead" style="color: #fbbf24; font-weight: 600;">Your Complete Business Intelligence Platform</p>
        <p style="color: #b45309; font-size: 1rem; font-weight: 600;">Real-time analytics, smart insights, and automated reporting</p>
        <div class="mt-4">
            <a href="/analytics" class="btn btn-primary btn-lg me-2">
                <i class="bi bi-graph-up-arrow"></i> Advanced Analytics
            </a>
            <button onclick="exportBusinessSummaryPDF()" class="btn btn-danger btn-lg">
                <i class="bi bi-file-pdf"></i> Export PDF
            </button>
>>>>>>> 7fb6acd397eec1b770bfde23ef8067077abc4054
        </div>
        <div class="stat-value" id="totalProducts">0</div>
        <div class="stat-label">Products</div>
        <small id="activeUsers" style="opacity: 0.8;">0 active users</small>
    </div>
<<<<<<< HEAD
    
    <div class="stat-card warning">
        <div class="stat-icon">
            <i class="fas fa-chart-line"></i>
=======

    <!-- Quick Stats Section -->
    <div class="row mb-4">
        <div class="col-md-12 mb-3">
            <h3 class="text-center" style="color: white; font-weight: 700;">ÔøΩ Real-Time Business Overview</h3>
        </div>
        <div class="col-md-4">
            <div class="stat-card success">
                <div class="text-center">
                    <i class="bi bi-cash-stack stat-icon" style="color: #10B981;"></i>
                    <div class="stat-value" id="totalRevenue">Loading...</div>
                    <div class="stat-label">Total Revenue</div>
                    <small class="text-muted" id="totalOrders">...</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card warning">
                <div class="text-center">
                    <i class="bi bi-box-seam stat-icon" style="color: #F59E0B;"></i>
                    <div class="stat-value" id="totalProducts">Loading...</div>
                    <div class="stat-label">Products</div>
                    <small class="text-muted" id="activeUsers">...</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card">
                <div class="text-center">
                    <i class="bi bi-graph-up-arrow stat-icon" style="color: #4F46E5;"></i>
                    <div class="stat-value" id="todaySales">Loading...</div>
                    <div class="stat-label">Today's Sales</div>
                    <small class="text-muted" id="todayOrders">...</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Reports Section -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-graph-up"></i> Sales Trend (Last 7 Days)
                </div>
                <div class="card-body">
                    <canvas id="salesTrendChart" height="100"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-trophy"></i> Top Selling Products (Last 30 Days)
                </div>
                <div class="card-body">
                    <div id="topProductsList">
                        <div class="text-center text-muted">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded text-center">
                                <small class="text-muted">Weekly Sales</small>
                                <h4 id="weeklySales" class="mb-0">$0.00</h4>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded text-center">
                                <small class="text-muted">Weekly Orders</small>
                                <h4 id="weeklyOrders" class="mb-0">0</h4>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded text-center">
                                <small class="text-muted">Avg Daily Sales</small>
                                <h4 id="avgDailySales" class="mb-0">$0.00</h4>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded text-center">
                                <small class="text-muted">Best Selling Day</small>
                                <h4 id="bestDay" class="mb-0">--</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Metrics -->
    <div class="row mb-5">
        <div class="col-md-12">
            <h3 class="text-center mb-4">üìà Performance Metrics</h3>
        </div>
        <div class="col-md-4">
            <div class="card text-center h-100">
                <div class="card-body">
                    <i class="bi bi-cart-check text-success" style="font-size: 2.5rem;"></i>
                    <h3 id="avgOrderValue" class="mt-3">$0.00</h3>
                    <p class="text-muted mb-0">Average Order Value</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center h-100">
                <div class="card-body">
                    <i class="bi bi-people text-primary" style="font-size: 2.5rem;"></i>
                    <h3 id="activeUsersCount" class="mt-3">0</h3>
                    <p class="text-muted mb-0">Active Users (30 Days)</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center h-100">
                <div class="card-body">
                    <i class="bi bi-clock-history text-info" style="font-size: 2.5rem;"></i>
                    <h3 id="lastUpdate" class="mt-3">--:--</h3>
                    <p class="text-muted mb-0">Last Updated</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Intelligent Business Intelligence Section -->
    <div class="row mb-5">
        <div class="col-md-12">
            <div class="card border-primary">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-lightbulb"></i> Smart Business Intelligence
                    </h5>
                    <button class="btn btn-light btn-sm" onclick="loadNotifications()" id="refreshNotificationsBtn">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Notifications Summary -->
                        <div class="col-md-4">
                            <div class="card h-100 border-warning">
                                <div class="card-header bg-warning text-dark">
                                    <h6 class="mb-0"><i class="bi bi-bell"></i> Smart Alerts</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="text-danger"><i class="bi bi-exclamation-triangle"></i> High Priority</span>
                                        <span class="badge bg-danger" id="highPriorityCount">0</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="text-warning"><i class="bi bi-info-circle"></i> Medium Priority</span>
                                        <span class="badge bg-warning" id="mediumPriorityCount">0</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span class="text-info"><i class="bi bi-check-circle"></i> Low Priority</span>
                                        <span class="badge bg-info" id="lowPriorityCount">0</span>
                                    </div>
                                    <button class="btn btn-primary btn-sm w-100" onclick="showAllNotifications()">
                                        <i class="bi bi-list"></i> View All Alerts
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Product Performance Insights -->
                        <div class="col-md-4">
                            <div class="card h-100 border-success">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0"><i class="bi bi-graph-up"></i> Product Insights</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-2">
                                        <small class="text-muted">Top Performers</small>
                                        <div class="badge bg-success" id="topPerformersCount">Loading...</div>
                                    </div>
                                    <div class="mb-2">
                                        <small class="text-muted">Low Performers</small>
                                        <div class="badge bg-danger" id="lowPerformersCount">Loading...</div>
                                    </div>
                                    <div class="mb-3">
                                        <small class="text-muted">Analysis Period</small>
                                        <div class="text-primary fw-bold">Last 3 Months</div>
                                    </div>
                                    <button class="btn btn-success btn-sm w-100" onclick="showProductInsights()">
                                        <i class="bi bi-bar-chart"></i> Detailed Analysis
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Festival Calendar -->
                        <div class="col-md-4">
                            <div class="card h-100 border-info">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0"><i class="bi bi-calendar-event"></i> Festival Calendar</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-2">
                                        <small class="text-muted">Upcoming Festivals</small>
                                        <div class="badge bg-info" id="upcomingFestivalsCount">Loading...</div>
                                    </div>
                                    <div class="mb-2">
                                        <small class="text-muted">Recommended Promotions</small>
                                        <div class="badge bg-primary" id="recommendedPromotionsCount">Loading...</div>
                                    </div>
                                    <div class="mb-3">
                                        <small class="text-muted">Current Month</small>
                                        <div class="text-info fw-bold" id="currentMonthName">December</div>
                                    </div>
                                    <button class="btn btn-info btn-sm w-100" onclick="showFestivalCalendar()">
                                        <i class="bi bi-calendar3"></i> View Calendar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Action Buttons -->
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <div class="d-flex flex-wrap gap-2">
                                <button class="btn btn-outline-primary btn-sm" onclick="loadNotifications()">
                                    <i class="bi bi-arrow-clockwise"></i> Refresh Intelligence
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="exportInsights()">
                                    <i class="bi bi-download"></i> Export Insights
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="window.location.href='/analytics'">
                                    <i class="bi bi-graph-up-arrow"></i> Full Analytics
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Access Panels -->
    <div class="row mb-5">
        <div class="col-md-12">
            <h3 class="text-center mb-4">üöÄ System Access</h3>
        </div>
        <div class="col-md-4">
            <div class="card access-card h-100">
                <div class="card-body text-center">
                    <i class="bi bi-shield-check text-primary mb-3" style="font-size: 3rem;"></i>
                    <h3 class="card-title">Admin Panel</h3>
                    <p class="card-text">Complete system management, analytics, and business intelligence dashboard</p>
                    <ul class="list-unstyled text-start mb-4">
                        <li>üìä Advanced Analytics</li>
                        <li>üë• User Management</li>
                        <li>üìß Email Marketing</li>
                        <li>ü§ñ AI Assistant</li>
                        <li>üìà Real-time Reports</li>
                    </ul>
                    <a href="/admin" class="btn btn-primary btn-lg">Access Admin Panel</a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card access-card h-100">
                <div class="card-body text-center">
                    <i class="bi bi-person-workspace text-success mb-3" style="font-size: 3rem;"></i>
                    <h3 class="card-title">Worker Panel</h3>
                    <p class="card-text">Streamlined interface for daily operations and product management</p>
                    <ul class="list-unstyled text-start mb-4">
                        <li>üì¶ Product Management</li>
                        <li>üìù Order Processing</li>
                        <li>üìä Performance Tracking</li>
                        <li>üîî Task Notifications</li>
                        <li>üìã Daily Reports</li>
                    </ul>
                    <a href="/worker" class="btn btn-success btn-lg">Access Worker Panel</a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card access-card h-100">
                <div class="card-body text-center">
                    <i class="bi bi-gear-wide-connected text-info mb-3" style="font-size: 3rem;"></i>
                    <h3 class="card-title">Labor Management</h3>
                    <p class="card-text">Track workforce activities and optimize labor efficiency</p>
                    <ul class="list-unstyled text-start mb-4">
                        <li>‚è∞ Time Tracking</li>
                        <li>üìä Productivity Analytics</li>
                        <li>üë∑ Worker Assignments</li>
                        <li>üìà Performance Metrics</li>
                        <li>üíº Resource Planning</li>
                    </ul>
                    <a href="/labor" class="btn btn-info btn-lg">Access Labor Panel</a>
                </div>
            </div>
        </div>
    </div>



    <!-- Shopping Section -->
    <div class="row mb-5">
        <div class="col-md-12">
            <h3 class="text-center mb-4">üõí Customer Experience</h3>
        </div>
        <div class="col-md-6">
            <div class="card shopping-card h-100">
                <div class="card-body text-center">
                    <i class="bi bi-shop text-warning mb-3" style="font-size: 3rem;"></i>
                    <h3 class="card-title">Browse Products</h3>
                    <p class="card-text">Explore our comprehensive product catalog with smart recommendations</p>
                    <div class="mb-3">
                        <span class="badge bg-primary me-2">AI Recommendations</span>
                        <span class="badge bg-success me-2">Real-time Inventory</span>
                        <span class="badge bg-info">Secure Shopping</span>
                    </div>
                    <a href="/products" class="btn btn-warning btn-lg">Start Shopping</a>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shopping-card h-100">
                <div class="card-body text-center">
                    <i class="bi bi-person-circle text-secondary mb-3" style="font-size: 3rem;"></i>
                    <h3 class="card-title">User Account</h3>
                    <p class="card-text">Manage your profile, orders, and personalized shopping experience</p>
                    <div class="mb-3">
                        <span class="badge bg-secondary me-2">Order History</span>
                        <span class="badge bg-primary me-2">Wishlist</span>
                        <span class="badge bg-success">Rewards</span>
                    </div>
                    <a href="/user/products" class="btn btn-secondary btn-lg">My Account</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Features Section -->
    <div class="row mb-5">
        <div class="col-md-12">
            <h3 class="text-center mb-4">‚ú® Platform Features</h3>
        </div>
        <div class="col-md-3">
            <div class="feature-card text-center">
                <i class="bi bi-robot text-primary mb-3" style="font-size: 2.5rem;"></i>
                <h5>AI Assistant</h5>
                <p class="text-muted">Smart chatbot for instant business insights</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="feature-card text-center">
                <i class="bi bi-graph-up text-success mb-3" style="font-size: 2.5rem;"></i>
                <h5>Real-time Analytics</h5>
                <p class="text-muted">Live dashboard with auto-refresh every 15 minutes</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="feature-card text-center">
                <i class="bi bi-envelope-paper text-info mb-3" style="font-size: 2.5rem;"></i>
                <h5>Email Marketing</h5>
                <p class="text-muted">Automated personalized customer outreach</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="feature-card text-center">
                <i class="bi bi-file-pdf text-danger mb-3" style="font-size: 2.5rem;"></i>
                <h5>PDF Reports</h5>
                <p class="text-muted">Detailed analytics exported in professional formats</p>
            </div>
>>>>>>> 7fb6acd397eec1b770bfde23ef8067077abc4054
        </div>
        <div class="stat-value" id="todaySales">$0</div>
        <div class="stat-label">Today's Sales</div>
        <small id="todayOrders" style="opacity: 0.8;">0 orders today</small>
    </div>
</div>

<!-- Quick Actions -->
<div class="flex justify-center gap-2 mb-4">
    <a href="/analytics" class="btn btn-primary btn-lg">
        <i class="fas fa-chart-bar"></i>
        View Analytics
    </a>
    <button onclick="exportBusinessSummaryPDF()" class="btn btn-danger btn-lg">
        <i class="fas fa-file-pdf"></i>
        Export Report
    </button>
</div>

<!-- Top Products Section -->
<div class="card mb-4">
    <div class="card-header">
        <i class="fas fa-trophy"></i> Top Products (30 Days)
    </div>
    <div id="topProductsList" style="padding: 1rem;">
        <div class="text-center text-muted">Loading...</div>
    </div>
</div>

<!-- System Access Cards -->
<div class="grid grid-3 mb-4">
    <div class="card text-center">
        <i class="fas fa-user-shield" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
        <h3 class="card-title">Admin Panel</h3>
        <p class="card-text">System management & analytics</p>
        <a href="/admin" class="btn btn-primary mt-2">Access Admin</a>
    </div>
    
    <div class="card text-center">
        <i class="fas fa-users" style="font-size: 3rem; color: var(--secondary); margin-bottom: 1rem;"></i>
        <h3 class="card-title">Worker Portal</h3>
        <p class="card-text">Manage products & sales</p>
        <a href="/worker" class="btn btn-secondary mt-2">Worker Login</a>
    </div>
    
    <div class="card text-center">
        <i class="fas fa-shopping-cart" style="font-size: 3rem; color: var(--info); margin-bottom: 1rem;"></i>
        <h3 class="card-title">Products</h3>
        <p class="card-text">Browse product catalog</p>
        <a href="/products" class="btn btn-outline mt-2">View Products</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Format currency helper
function formatCurrency(amount) {
    return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    }).format(amount);
}

// Load business stats
async function loadBusinessStats() {
    try {
        const response = await fetch('/api/business-stats');
        if (!response.ok) {
            throw new Error('Failed to fetch data');
        }
        const data = await response.json();
        
        console.log('Business stats loaded:', data);
        
        // Update stats
        document.getElementById('totalRevenue').textContent = formatCurrency(data.total_sales || 0);
        document.getElementById('totalOrders').textContent = (data.total_orders || 0).toLocaleString() + ' orders';
        document.getElementById('totalProducts').textContent = data.total_products || 0;
        document.getElementById('activeUsers').textContent = (data.active_users || 0) + ' active users';
        document.getElementById('todaySales').textContent = formatCurrency(data.sales_today || 0);
        document.getElementById('todayOrders').textContent = (data.orders_today || 0) + ' orders today';
        
        // Load top products
        loadTopProducts(data.top_products || []);
    } catch (error) {
        console.error('Error loading stats:', error);
        document.getElementById('topProductsList').innerHTML = 
            '<div class="text-center text-danger">Failed to load data. Please refresh the page.</div>';
    }
}

// Load top products
function loadTopProducts(products) {
    const container = document.getElementById('topProductsList');
    if (!container) return;
    
<<<<<<< HEAD
    if (products.length === 0) {
        container.innerHTML = '<div class="text-center text-muted">No data available</div>';
        return;
    }
    
    container.innerHTML = products.map((p, i) => `
        <div class="flex justify-between items-center p-2 mb-2" style="background: var(--gray-50); border-radius: var(--border-radius-sm);">
            <div>
                <div class="fw-semibold">${i + 1}. ${p.name || 'Unknown Product'}</div>
                <small class="text-muted">${p.units || 0} units sold</small>
=======
    // Static Tamil products - always show these
    const tamilProducts = [
        { name: 'Basmati Rice', units: 145, revenue: 45678.50 },
        { name: 'Idli Batter', units: 98, revenue: 32456.75 },
        { name: 'Sambar Powder', units: 76, revenue: 28934.20 },
        { name: 'Coconut Oil', units: 63, revenue: 24567.80 },
        { name: 'Jaggery (Vellam)', units: 52, revenue: 18945.60 }
    ];
    
    let html = '<div class="list-group">';
    tamilProducts.forEach((product, index) => {
        const badgeClass = index === 0 ? 'warning' : index === 1 ? 'secondary' : 'info';
        html += `
            <div class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <span class="badge bg-${badgeClass} me-2">#${index + 1}</span>
                    <strong>${product.name}</strong>
                    <small class="text-muted d-block">${product.units} units sold</small>
                </div>
                <span class="badge bg-success rounded-pill">‚Çπ${product.revenue.toLocaleString('en-IN', {minimumFractionDigits: 2})}</span>
>>>>>>> 7fb6acd397eec1b770bfde23ef8067077abc4054
            </div>
            <div class="fw-bold text-primary">${formatCurrency(p.revenue || 0)}</div>
        </div>
    `).join('');
}

// Export business summary (stub)
function exportBusinessSummaryPDF() {
    if (window.showInfo) {
        window.showInfo('PDF export feature coming soon!');
    } else {
        alert('PDF export feature coming soon!');
    }
}

// Load stats on page load
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, fetching business stats...');
    loadBusinessStats();
});
</script>
{% endblock %}
