{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-md-8">
            <h2>Welcome, {{ user.name }}!</h2>
        </div>
        <div class="col-md-4 text-end">
            <a href="{{ url_for('labor_logout') }}" class="btn btn-outline-danger">Logout</a>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="input-group">
                <input type="text" id="searchInput" class="form-control" placeholder="Search products...">
                <select id="categoryFilter" class="form-select" style="max-width: 200px;">
                    <option value="">All Categories</option>
                </select>
            </div>
        </div>
    </div>

    <div class="row" id="productsGrid">
        {% for product in products %}
        <div class="col-md-4 mb-4 product-card" 
             data-category="{{ product.category }}"
             data-name="{{ product.name }}">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title">{{ product.name }}</h5>
                    <p class="card-text">Category: {{ product.category }}</p>
                    <div class="variants-container">
                        <label for="variant-{{ product._id }}" class="form-label">Select Quantity:</label>
                        <select class="form-select variant-select" id="variant-{{ product._id }}" 
                                data-product-id="{{ product._id }}">
                            {% for variant in product.variants %}
                            <option value="{{ loop.index0 }}" 
                                    data-price="{{ variant.price }}"
                                    data-quantity="{{ variant.quantity }}"
                                    data-stock="{{ variant.stock }}"
                                    {% if variant.stock <= 0 %}disabled{% endif %}>
                                {{ variant.quantity }} - ${{ variant.price }} 
                                {% if variant.stock <= 0 %}(Out of Stock){% endif %}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mt-3">
                        <label class="form-label">Payment Method:</label>
                        <select class="form-select payment-method" id="payment-{{ product._id }}">
                            <option value="credit_card">Credit Card</option>
                            <option value="debit_card">Debit Card</option>
                            <option value="upi">UPI</option>
                            <option value="net_banking">Net Banking</option>
                        </select>
                    </div>
                </div>
                <div class="card-footer">
                    <button class="btn btn-primary buy-now-btn" 
                            data-product-id="{{ product._id }}"
                            data-product-name="{{ product.name }}">
                        Buy Now
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize category filter
    const categories = new Set();
    document.querySelectorAll('.product-card').forEach(card => {
        categories.add(card.dataset.category);
    });

    const categoryFilter = document.getElementById('categoryFilter');
    categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categoryFilter.appendChild(option);
    });

    // Filter function
    function filterProducts() {
        const selectedCategory = categoryFilter.value.toLowerCase();
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();

        document.querySelectorAll('.product-card').forEach(card => {
            const category = card.dataset.category.toLowerCase();
            const name = card.dataset.name.toLowerCase();
            const matchesCategory = !selectedCategory || category === selectedCategory;
            const matchesSearch = !searchTerm || name.includes(searchTerm);
            
            card.style.display = matchesCategory && matchesSearch ? '' : 'none';
        });
    }

    // Add event listeners
    categoryFilter.addEventListener('change', filterProducts);
    document.getElementById('searchInput').addEventListener('input', filterProducts);

    // Buy Now functionality
    document.querySelectorAll('.buy-now-btn').forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.dataset.productId;
            const productName = this.dataset.productName;
            const productPrice = this.dataset.productPrice;
            
            // Here you can implement the purchase functionality
            alert(`Product "${productName}" will be purchased for $${productPrice}`);
        });
    });
});</script>
{% endblock %}